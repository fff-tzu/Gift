<!DOCTYPE html>  
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>18å²ç”Ÿæ—¥å¿«ä¹</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&family=Kaushan+Script&display=swap" rel="stylesheet">
  <style>
    .page { display: none; }
    .page.active { display: block; }
    .container { max-width: 600px; margin: auto; padding: 10px; font-family: 'Zhi Mang Xing', cursive; }
    .music-control { text-align: right; margin-bottom: 10px; }
    .tape { width: 80px; transform: rotate(-10deg);opacity: 0.8;position: absolute; z-index: 5;}
    .top-left { top: 0; left: 0; }
    .top-right { top: 0; right: 0; }
    .sticker { width: 60px; position: fixed; bottom: 10px; right: 10px; }
    .sticker.bottom-right { width: 80px;right: 560px; bottom: 180px;transform: rotate(25deg); }
    .puzzle-board { width: 300px; height: 300px; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); border: 1px solid #ccc; gap: 1px; }
    .puzzle-piece { width: 100px; height: 100px; background-image: url('images/puzzle.jpg'); background-size: 300px 300px; border: 1px solid #999; box-sizing: border-box; cursor: grab; }
    .blessing-container { display: flex; flex-direction: column; align-items: center; }
    .carousel { width: 100vw; height: 100vh; overflow: hidden; position: fixed; top: 0; left: 0; z-index: -1; filter: blur(2px); }
    .carousel-img { position: absolute; opacity: 0; transition: opacity 1s ease; width: 100%; height: 100%; object-fit: cover; }
    .carousel-img.active { opacity: 1; }
    #page-3 { position: relative; color: white; text-shadow: 1px 1px 2px black; }
    .blessing-text { margin-top: 20px; font-size: 24px; text-align: center; }
    #next-btn { 
      position: relative;
      z-index: 2;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 15px; 
    }
    .tag-item {
      background-color: #fdf6e3;
      color: #5d4037;
      padding: 6px 12px;
      border-radius: 20px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
      font-size: 16px;
      font-family: 'Zhi Mang Xing', cursive;
      cursor: default;
      transition: background-color 0.3s;
    }

    .tag-item:hover {
      background-color: #ffe0b2;
    }
      #photo-wall {
    position: relative;
    width: 100%;
    height: 80vh;
    background-color: #fefaf3;
    border: 2px dashed #ddd;
    overflow: hidden;
  }

  .photo {
    position: absolute;
    width: 150px;
    height: 100px;
    object-fit: cover;
    border: 4px solid white;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
    opacity: 0;
    transform: scale(0.5) rotate(0deg);
    animation: dropPhoto 0.8s ease forwards;
  }

  @keyframes dropPhoto {
    0% {
      opacity: 0;
      transform: translateY(-100px) scale(0.5) rotate(0deg);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1) rotate(var(--angle));
    }
  }

  #card-result {
  margin-top: 20px;
  min-height: 180px;
  position: relative;
  width: 320px;
  height: 200px;
  background-image: url('images/fortune-paper.png');
  background-size: cover;          /* æ”¹ä¸ºcontainï¼Œä¿è¯å®Œæ•´æ˜¾ç¤º */
  background-repeat: no-repeat;
  background-position: center center; /* è°ƒæ•´å±…ä¸­ */
  color: #6a4a3c;
  font-family: 'Kaushan Script', cursive;
  font-size: 18px;                  /* å­—ä½“å˜å° */
  padding: 20px;
  box-sizing: border-box;
  border-radius: 20px;             /* åœ†è§’æ›´å¤§ä¸€ç‚¹ */
  box-shadow: 4px 4px 12px rgba(0,0,0,0.2); /* é˜´å½±æ›´æŸ”å’Œ */
  user-select: none;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
}

#card-buttons {
  margin-top: 15px;
  display: flex;
  gap: 15px;
  justify-content: center;
}

#card-buttons button {
  padding: 8px 20px;
  font-size: 16px;
  border-radius: 25px;             /* åœ†å½¢æŒ‰é’® */
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg, #f9cda0, #f2a365);
  box-shadow: 0 4px 8px rgba(242, 163, 101, 0.5);
  color: #5d4037;
  font-weight: 600;
  transition: all 0.3s ease;
  font-family: 'Kaushan Script', cursive;
}

#card-buttons button:hover {
  background: linear-gradient(135deg, #faaf76, #f9cda0);
  box-shadow: 0 6px 12px rgba(242, 163, 101, 0.7);
  transform: translateY(-2px);
}
#blessing-text {
  font-size: 22px; /* è®¾ç½®å­—ä½“å¤§å° */
  color: #bc5a29; /* è®¾ç½®å­—ä½“é¢œè‰² */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2); /* å¯é€‰ï¼šå¢åŠ æ–‡å­—é˜´å½±æ•ˆæœ */
}

body {
  background: url('images/background-paper.jpg') no-repeat center center fixed;
  background-size: cover;  /* æ‹‰ä¼¸å¡«æ»¡æ•´ä¸ªå±å¹• */
}

@keyframes floatBg {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 1000px 1000px;
  }
}


  </style>
</head>
<body>
  <audio id="bg-music" src="audio/birthday-melody.mp3" autoplay loop></audio>
  <div class="container">
    <div class="music-control">
      <button onclick="toggleMusic()">ğŸµ éŸ³ä¹å¼€å…³</button>
      <label style="margin-left: 10px;">
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" onchange="setVolume(this.value)">
      </label>
    </div>

    <div class="notebook" style="position: relative;">
      <img src="images/washi-tape1.png" class="tape top-left" />
      <img src="images/washi-tape2.png" class="tape top-right" />
      <h1 class="title">ğŸ‚ Happy Birthday ğŸ‰</h1>
      <div class="page-controls" style="margin-bottom:10px;">
        <button onclick="prevPage()">â† ä¸Šä¸€é¡µ</button>
        <span id="page-indicator">ç¬¬ 1 é¡µ / 6 é¡µ</span>
        <button onclick="nextPage()">ä¸‹ä¸€é¡µ â†’</button>
      </div>
      <div id="page-1" class="page active">
        <p class="intro">To æˆ‘æœ€æœ€æœ€æœ€äº²çˆ±çš„æ€å¦ï¼š</p>
        <p class="message">ä½ åˆå˜å¥½çœ‹äº†ä¸€å²å·²ç»â€”â€”</p>
        <p class="days" id="days-count">è®¡ç®—ä¸­...</p>
      </div>
      <div id="page-2" class="page">
        <div class="button-area">
          <button onclick="startPuzzle()">å¼€å§‹è§£é”ç”Ÿæ—¥æ‹¼å›¾ ğŸ</button>
        </div>
        <div id="puzzle-area" style="display: none;">
          <h3 class="puzzle-title">ğŸ² æ‹¼å›¾æŒ‘æˆ˜ï¼</h3>
          <div id="puzzle" class="puzzle-board"></div>
        </div>
      </div>
      <div id="page-3" class="page">
        <div id="hidden-message" class="blessing-container" style="display: none;">
          <div class="carousel">
            <img src="images/birthday1.jpg" class="carousel-img active" alt="ç¥ç¦1">
            <img src="images/birthday2.jpg" class="carousel-img" alt="ç¥ç¦2">
            <img src="images/birthday3.jpg" class="carousel-img" alt="ç¥ç¦3">
            <img src="images/birthday4.jpg" class="carousel-img" alt="ç¥ç¦4">
          </div>
          <div class="blessing-text" id="blessing-text"></div>
          <button id="next-btn" style="display:none; margin-top: 10px;" onclick="nextPage(); resetPage3();">ä¸‹ä¸€é¡µ ğŸˆ</button>
        </div>
      </div>

      <div id="page-4" class="page">
        <h2>å¤´åƒäº’åŠ¨å¢™</h2>
        <div style="display: flex; flex-direction: row; gap: 20px; align-items: flex-start;">
          <div style="display: flex; flex-direction: column; align-items: center;">
            <div style="width: 200px; height: 200px; border: 3px dashed #888; border-radius: 50%; overflow: hidden; margin-bottom: 10px; position: relative;">
              <img id="avatar-preview" src="images/avatar-placeholder.png" alt="å¤´åƒ" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <input type="file" accept="image/*" onchange="previewAvatar(this)" />
          </div>

          <div style="flex: 1;">
            <h3>è´´æ ‡ç­¾~</h3>
            <ul id="tag-list" style="list-style: none; padding-left: 0; display: flex; flex-wrap: wrap; gap: 10px;"></ul>
            <div style="margin-top: 10px;">
              <input type="text" id="new-tag" placeholder="è¾“å…¥æ–°æ ‡ç­¾" style="width: 70%; padding: 6px; border: 1px solid #aaa; border-radius: 6px;" />
              <button onclick="addTag()" style="padding: 6px 10px; margin-left: 5px;">â• æ·»åŠ </button>
            </div>
          </div>
        </div>
      </div>


      <div id="page-5" class="page">
        <h2>å›å¿†ç›¸å†Œå¢™</h2>
        <div id="photo-wall"></div>
      </div>
      <div id="page-6" class="page">
        <h2>æŠ½å¡å°æ¸¸æˆ</h2>
        <button id="draw-btn" onclick="drawCard()">æŠ½ä¸€å¼ ç¥ç¦å¡</button>
        <div id="card-result" style="margin-top:20px;"></div>
      </div>
      <img src="images/sticker-heart.png" class="sticker bottom-right" />
    </div>
    <!-- æŸ¥çœ‹å¤§å›¾çš„å¼¹çª— -->
    <div id="image-viewer" style="
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    ">
      <img id="full-image" src="" style="max-width: 90%; max-height: 90%; border: 5px solid white; box-shadow: 0 0 15px rgba(0,0,0,0.5);" />
    </div>

  </div>
  <script>
    const birthday = new Date("2025-05-26");
    function updateDaysCount() {
      const today = new Date();
      const diffTime = Math.abs(today - birthday);
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      document.getElementById("days-count").innerText = `${diffDays} å¤© ğŸˆ`;
    }
    updateDaysCount();

    // éŸ³ä¹æ§åˆ¶
    function toggleMusic() {
      const audio = document.getElementById("bg-music");
      if (audio.paused) audio.play();
      else audio.pause();
    }

    function setVolume(val) {
      document.getElementById("bg-music").volume = val;
    }

    // é¡µé¢åˆ‡æ¢
    let currentPage = 1;
    function showPage(page) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.getElementById(`page-${page}`).classList.add("active");
      document.getElementById("page-indicator").textContent = `ç¬¬ ${page} é¡µ / 6 é¡µ`;
      currentPage = page;

      if (page === 5) {
        loadPhotoWall();
      }
    }

    function nextPage() {
      if (currentPage < 6) showPage(currentPage + 1);
    }
    function prevPage() {
      if (currentPage > 1) showPage(currentPage - 1);
    }

    // æ‹¼å›¾æ¸¸æˆ
    function startPuzzle() {
      const puzzleArea = document.getElementById("puzzle-area");
      puzzleArea.style.display = "block";
      const puzzle = document.getElementById("puzzle");
      puzzle.innerHTML = "";
      const order = Array.from({ length: 9 }, (_, i) => i);
      shuffleArray(order);
      order.forEach((val, idx) => {
        const piece = document.createElement("div");
        piece.className = "puzzle-piece";
        piece.style.backgroundPosition = `-${(val % 3) * 100}px -${Math.floor(val / 3) * 100}px`;
        piece.dataset.correct = val;
        piece.dataset.index = idx;
        piece.draggable = true;
        piece.addEventListener("dragstart", dragStart);
        piece.addEventListener("dragover", e => e.preventDefault());
        piece.addEventListener("drop", dropPiece);
        puzzle.appendChild(piece);
      });
    }

    let dragged;
    function dragStart(e) {
      dragged = e.target;
    }

    function dropPiece(e) {
      if (!dragged || dragged === e.target) return;
      const tempPos = dragged.style.backgroundPosition;
      const tempCorrect = dragged.dataset.correct;
      dragged.style.backgroundPosition = e.target.style.backgroundPosition;
      dragged.dataset.correct = e.target.dataset.correct;
      e.target.style.backgroundPosition = tempPos;
      e.target.dataset.correct = tempCorrect;
      checkWin();
    }
    function checkWin() {
      const pieces = document.querySelectorAll(".puzzle-piece");
      const isWin = Array.from(pieces).every((el, idx) => el.dataset.correct == idx);
      if (isWin) {
        showBlessing();
      }
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
    function showBlessing() {
      const container = document.getElementById("hidden-message");
      container.style.display = "flex";
      startCarousel();
      typeBlessing([
        "ğŸ‰ è§£é”æˆåŠŸï¼",
        "åœ°çƒonlineğŸŒï¼š",
        "äº²çˆ±çš„ç©å®¶ï¼Œæ­å–œä½ æˆåŠŸå¼€å¯ç¬¬18ç« ï¼Œ",
        "è¯·ç»§ç»­å‘å‰æ¢ç´¢ä¸»çº¿ï¼Œ",
        "è§£é”æ›´å¤šå‰§æƒ…ï¼Œ",
        "ç¥æ‚¨æ¸¸æˆæ„‰å¿«ï¼Œ",
        "ç”Ÿæ´»é¡ºåˆ©ï¼"
      ]);
      currentPage = 3;
      showPage(currentPage);
    }
    let carouselInterval;

    function startCarousel() {
      const images = document.querySelectorAll(".carousel-img");
      let index = 0;
      if (carouselInterval) clearInterval(carouselInterval);
      carouselInterval = setInterval(() => {
        images.forEach(img => img.classList.remove("active"));
        index = (index + 1) % images.length;
        images[index].classList.add("active");
      }, 3000);
    }
    function typeBlessing(lines) {
      const container = document.getElementById("blessing-text");
      container.innerHTML = "";
      let i = 0;
      function showLine() {
        if (i < lines.length) {
          const p = document.createElement("div");
          p.textContent = "";
          container.appendChild(p);
          let charIndex = 0;
          const typing = setInterval(() => {
            p.textContent += lines[i][charIndex];
            charIndex++;
            if (charIndex === lines[i].length) {
              clearInterval(typing);
              i++;
              setTimeout(showLine, 600);
            }
          }, 50);
        } else {
          setTimeout(() => {
            document.getElementById("next-btn").style.display = "block";
          }, 1000);
        }
      }
      showLine();
    }
    function resetPage3() {
      clearInterval(carouselInterval);
      document.getElementById("hidden-message").style.display = "none";
    }

    // æ ‡ç­¾é€»è¾‘
    function addTag() {
      const input = document.getElementById("new-tag");
      const tagList = document.getElementById("tag-list");
      const tag = input.value.trim();
      if (!tag) return;

      const tags = getTags();
      tags.push(tag);
      saveTags(tags);
      renderTags();
      input.value = "";
    }

    function renderTags() {
      const tagList = document.getElementById("tag-list");
      tagList.innerHTML = "";
      const tags = getTags();
      tags.forEach((tag, index) => {
        const li = document.createElement("li");
        li.className = "tag-item";
        li.textContent = tag;
        li.title = "ç‚¹å‡»åˆ é™¤æ ‡ç­¾";
        li.onclick = () => {
          if (confirm(`ç¡®è®¤åˆ é™¤æ ‡ç­¾ "${tag}" å—ï¼Ÿ`)) {
            tags.splice(index, 1);
            saveTags(tags);
            renderTags();
          }
        };
        tagList.appendChild(li);
      });
    }

    function getTags() {
      return JSON.parse(localStorage.getItem("birthdayTags") || "[]");
    }

    function saveTags(tags) {
      localStorage.setItem("birthdayTags", JSON.stringify(tags));
    }

    // å¤´åƒé€»è¾‘
    function previewAvatar(input) {
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const avatar = document.getElementById("avatar-preview");
        avatar.src = e.target.result;
        localStorage.setItem("birthdayAvatar", e.target.result);
      };
      reader.readAsDataURL(file);
    }

    function loadAvatar() {
      const avatar = localStorage.getItem("birthdayAvatar");
      if (avatar) {
        document.getElementById("avatar-preview").src = avatar;
      }
    }

    // åˆå§‹åŒ–æ‰§è¡Œ
    window.addEventListener("DOMContentLoaded", () => {
      renderTags();
      loadAvatar();
      showPage(currentPage);
    });

    // æŠ½å¡å ä½åŠŸèƒ½
    function drawCard() {
      const result = document.getElementById("card-result");
      const blessings = [
        "æ„¿ä½ å¿«ä¹æ— è¾¹ ğŸ’«",
        "æ–°çš„ä¸€å²æ›´é—ªäº® âœ¨",
        "æ°¸è¿œå¯çˆ±å–„è‰¯ ğŸ§¸",
        "å¥½è¿è¿è¿ã€å¼€å¿ƒæ¯ä¸€å¤© ğŸ€"
      ];
      const randomBlessing = blessings[Math.floor(Math.random() * blessings.length)];
      result.textContent = `ğŸ‰ ${randomBlessing}`;
    }
    // ç‚¹å‡»æŸ¥çœ‹å¤§å›¾åŠŸèƒ½
document.addEventListener("click", function (e) {
  if (e.target.classList.contains("photo") || e.target.classList.contains("zoomable")) {
    const src = e.target.src;
    const viewer = document.getElementById("image-viewer");
    const fullImg = document.getElementById("full-image");
    fullImg.src = src;
    viewer.style.display = "flex";
  }
});

// ç‚¹å‡»ç©ºç™½å¤„å…³é—­å¤§å›¾
document.getElementById("image-viewer").addEventListener("click", function () {
  this.style.display = "none";
});

    function loadPhotoWall() {
      const wall = document.getElementById("photo-wall");
      wall.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹

      const photoCount = 10;
      for (let i = 1; i <= photoCount; i++) {
        const img = document.createElement("img");
        img.src = `images/photo${i}.jpg`;
        img.className = "photo";

        // éšæœºä½ç½®
        const x = Math.random() * (wall.clientWidth - 160); // å‡å»å®½åº¦
        const y = Math.random() * (wall.clientHeight - 110); // å‡å»é«˜åº¦

        // éšæœºæ—‹è½¬è§’åº¦
        const angle = (Math.random() * 60 - 30).toFixed(2); // -30 ~ +30 deg
        img.style.left = `${x}px`;
        img.style.top = `${y}px`;
        img.style.setProperty("--angle", `${angle}deg`);

        // å»¶è¿Ÿæ·»åŠ å®ç°â€œé€å¼ æ‰è½â€
        setTimeout(() => wall.appendChild(img), i * 300);
      }
    }

    // ç¥ç¦è¯­æ•°ç»„ï¼Œéšæ„æ›¿æ¢æˆ–æ‰©å±•
    const blessings = [
      "ç¥æ—¥æ—¥å¥½å¤©",
      "ç¥ä½ å§‹ç»ˆå¹¸ç¦",
      "ä¸€å®šè¦å¿«ä¹ï¼Œå¥½å˜›ï¼",
      "ç¥ä½ é‡è§å¥½å¤©æ°”",
      "æˆ‘ç¥ä½ æ˜¯ç¹ç››çš„ç«ç„°ï¼ŒèŠ±æœµèˆ¬çƒ§æ»¡æ˜¥å¤©",
      "All is well",
      "ç¥ä½ ç¡è§‰æ„‰å¿«ğŸ¤—",
      "æ–°å¹´å¿«ä¹ï¼Œç¥ä½ æ°¸è¿œæ˜¯ä½ ",
    ];

    // çŠ¶æ€å˜é‡ï¼Œæ§åˆ¶æ˜¯å¦é”å®šæŠ½ç­¾ç»“æœ
    let locked = false;

    function drawCard() {
      if (locked) return; // é”å®šåä¸å…è®¸å†æ¬¡æŠ½

      // éšæœºæŠ½å–ç¥ç¦è¯­
      const randomIndex = Math.floor(Math.random() * blessings.length);
      const blessingText = blessings[randomIndex];

      // è·å–ç»“æœå®¹å™¨
      const cardResult = document.getElementById("card-result");

      // åŠ¨æ€æ·»åŠ ç¥ç¦æ–‡æœ¬å’ŒæŒ‰é’®åŒºåŸŸ
      cardResult.innerHTML = `
        <div id="blessing-text">${blessingText}</div>
        <div id="card-buttons">
          <button id="lock-btn" onclick="lockCard()">é”å®šç¥ç¦</button>
        </div>
      `;

      locked = false; // æŠ½æ–°å¡æ—¶æœªé”å®š
    }

    function lockCard() {
      locked = true;
      const cardButtons = document.getElementById("card-buttons");
      cardButtons.innerHTML = `
        <button onclick="resetCard()">é‡æ–°æŠ½ç­¾</button>
      `;
    }

    function resetCard() {
      locked = false;
      const cardResult = document.getElementById("card-result");
      cardResult.innerHTML = "";
    }

  </script>
  
</body>
</html>